# Функционал обложки карточки

## Что добавлено

### 1. Чекбокс "Обложка" в модалке карточки
- Появляется рядом с заголовком "Изображения" когда есть хотя бы одно изображение
- При включении первое изображение (по порядку) используется как обложка карточки

### 2. Drag & Drop для изменения порядка изображений
- Изображения можно перетаскивать для изменения порядка
- Иконка захвата (GripVertical) появляется при наведении
- Порядок сохраняется автоматически на сервере
- Первое изображение становится обложкой при включенном чекбоксе

### 3. Отображение обложки на карточке в списке задач
- Если `showCover = true` и есть изображения, первое изображение отображается как обложка
- Обложка занимает верхнюю часть карточки (высота 128px)
- Контент карточки (теги, название, дата) отображается под обложкой

## Изменения в базе данных

### Модель Card
```prisma
model Card {
  // ...
  showCover Boolean @default(false) // Показывать первое изображение как обложку
  // ...
}
```

### Модель CardImage
```prisma
model CardImage {
  // ...
  order Int @default(0) // Порядок отображения
  // ...
}
```

## API Endpoints

### PATCH /api/cards/[cardId]
Добавлен параметр `showCover` для включения/выключения обложки

### PATCH /api/cards/[cardId]/images/reorder
Новый endpoint для изменения порядка изображений
```typescript
{
  imageOrders: [
    { id: "image1", order: 0 },
    { id: "image2", order: 1 },
    // ...
  ]
}
```

## Применение изменений

1. **Применить миграцию БД:**
```bash
npx prisma migrate dev --name add_cover_and_order
```

2. **Сгенерировать Prisma клиент:**
```bash
npx prisma generate
```

3. **Перезапустить сервер:**
```bash
npm run dev
```

## Использование

1. Откройте карточку
2. Загрузите несколько изображений
3. Перетащите изображения для изменения порядка (первое будет обложкой)
4. Включите чекбокс "Обложка"
5. Закройте модалку - на карточке в списке появится обложка

## Технические детали

- Изображения сортируются по полю `order` (ASC)
- При загрузке нового изображения ему присваивается `order = max(order) + 1`
- При перетаскивании порядок пересчитывается и сохраняется
- Обложка использует `thumbnailUrl` если доступно, иначе `url`
- Компонент галереи предотвращает сброс порядка во время drag & drop
