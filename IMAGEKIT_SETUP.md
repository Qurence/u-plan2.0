# Настройка ImageKit для загрузки изображений

## Шаг 1: Создание аккаунта ImageKit

1. Зарегистрируйтесь на [ImageKit.io](https://imagekit.io/)
2. Создайте новый проект или используйте существующий

## Шаг 2: Получение ключей API

1. Перейдите в **Developer Options** → **API Keys**
2. Скопируйте следующие значения:
   - **Public Key**
   - **Private Key**
   - **URL Endpoint**

## Шаг 3: Добавление переменных окружения

Добавьте следующие переменные в файл `.env`:

```env
# ImageKit Configuration
NEXT_PUBLIC_IMAGEKIT_PUBLIC_KEY=your_public_key_here
IMAGEKIT_PRIVATE_KEY=your_private_key_here
NEXT_PUBLIC_IMAGEKIT_URL_ENDPOINT=https://ik.imagekit.io/your_id
```

## Шаг 4: Применение миграции базы данных

Выполните следующую команду для применения миграции:

```bash
npx prisma migrate dev --name add_card_images
```

Или если вы используете продакшн:

```bash
npx prisma migrate deploy
```

## Шаг 5: Генерация Prisma клиента

После миграции сгенерируйте Prisma клиент:

```bash
npx prisma generate
```

## Шаг 6: Перезапуск сервера разработки

Перезапустите сервер разработки:

```bash
npm run dev
```

## Использование

После настройки вы сможете:

1. **Загружать изображения** к карточкам через модальное окно карточки
2. **Просматривать галерею** изображений в карточке
3. **Удалять изображения** из карточки
4. **Увеличивать изображения** для детального просмотра

## Ограничения

- Максимальный размер файла: **10 MB**
- Поддерживаемые форматы: все форматы изображений (jpg, png, gif, webp и т.д.)
- Изображения хранятся в папке `/cards/{cardId}` в ImageKit

## Безопасность

- Private Key хранится только на сервере и не передается клиенту
- Все загрузки требуют аутентификации пользователя
- Проверяются права доступа к карточке перед загрузкой/удалением изображений

## Troubleshooting

### Ошибка "Property 'cardImage' does not exist"

Это означает, что Prisma клиент не был сгенерирован после добавления новой модели. Выполните:

```bash
npx prisma generate
```

### Ошибка загрузки в ImageKit

Проверьте:
1. Правильность API ключей в `.env`
2. Что URL Endpoint указан корректно
3. Что в ImageKit включена опция "Allow unsigned uploads" (если используется)
